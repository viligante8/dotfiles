return {
  "olimorris/codecompanion.nvim",
  -- Disabled by default via .disabled filename
  dependencies = {
    "nvim-lua/plenary.nvim",
    "nvim-treesitter/nvim-treesitter",
    "stevearc/dressing.nvim",
  },
  config = function()
    local ok, codecompanion = pcall(require, "codecompanion")
    if not ok then
      return
    end

    -- Minimal OpenAI adapter using OPENAI_API_KEY
    codecompanion.setup({
      adapters = {
        openai = function()
          local adapters = require("codecompanion.adapters")
          return adapters.extend("openai", {
            env = { api_key = os.getenv("OPENAI_API_KEY") },
            schema = {
              model = { default = "gpt-4o" },
            },
          })
        end,
      },
      strategies = {
        chat = { adapter = "openai" },
        inline = { adapter = "openai" },
      },
    })
  end,
}
