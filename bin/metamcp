#!/bin/bash

# Start metamcp dev server in tmux
PROJECT_PATH="$HOME/dev/mcp-servers/metamcp"
SESSION_NAME="metamcp"

# Check if session already exists
if tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
    # If we're already in tmux, switch client; otherwise attach
    if [ -n "$TMUX" ]; then
        tmux switch-client -t "$SESSION_NAME"
    else
        tmux attach-session -t "$SESSION_NAME"
    fi
    exit 0
fi

# Create new session and run pnpm dev
tmux new-session -d -s "$SESSION_NAME" -c "$PROJECT_PATH"
tmux send-keys -t "$SESSION_NAME" 'pnpm i && pnpm run build && pnpm run dev' Enter

# Attach to session
if [ -n "$TMUX" ]; then
    tmux switch-client -t "$SESSION_NAME"
else
    tmux attach-session -t "$SESSION_NAME"
fi
